{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sweet Spot | Home</title>
    <link rel="stylesheet" href="{% static 'testapp/css/style.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Import Playfair Display font */
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&display=swap');
        
        /* Define theme variables */
        :root {
            --primary-red: #B22222;
            --accent-pink: #ff6489;
            --soft-bg: #fff8f8;
            --light-pink-bg: #fff0f4;
            --heading-font: 'Playfair Display', 'Georgia', 'Cambria', serif;
            --body-font: 'Poppins', sans-serif;
            --shadow: 0 8px 18px rgba(255, 155, 170, 0.2);
            --shadow-hover: 0 12px 25px rgba(255, 128, 160, 0.35);
        }

        /* Base body styles */
        body { background-color: var(--soft-bg); font-family: var(--body-font); margin: 0;}
        h1, h2, h3, h4, h5, h6 { font-family: var(--heading-font); }
        h2 { font-size: 2.5rem; text-align: center; margin-bottom: 2.5rem; color: var(--primary-red); }
        section { padding: 4rem 1rem; }
        .container, .features, .about, .reviews { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }

        /* Hero styles */
        .hero { background-image: linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2)), url("{% static 'testapp/images/hero-bg.jpg' %}"); background-size: cover; background-position: center; height: 70vh; display: flex; align-items: center; justify-content: center; text-align: center; }
        .hero-content { color: #fff; max-width: 650px; text-shadow: 0 2px 5px rgba(0,0,0,0.4); }
        .hero-content h1 { font-size: 3.8rem; font-weight: 700; margin-bottom: 0.5rem; }
        .hero-content p { font-size: 1.2rem; font-weight: 300; margin-bottom: 2rem; color: rgba(255, 255, 255, 0.95); }
        
        /* General Button styles (Applies if not overridden by .card--all-time-fav button) */
        .btn { background-color: var(--accent-pink); color: white; border: none; padding: 0.8rem 1.8rem; font-size: 1rem; font-weight: 600; font-family: var(--body-font); border-radius: 25px; cursor: pointer; text-decoration: none; transition: all 0.3s ease; }
        .btn:hover { background-color: var(--primary-red); transform: scale(1.05); box-shadow: var(--shadow-hover); }
        .btn.big { font-size: 1.1rem; padding: 1rem 2.5rem; }

        /* Best Sellers section */
        .best-sellers { background-color: #fff; }
        
        /* Carousel specific styles */
        .carousel-wrapper { position: relative; max-width: 1200px; margin: 0 auto; padding: 0 2rem; }
        .carousel-container { display: flex; overflow-x: auto; gap: 2rem; padding: 1.5rem 0; -ms-overflow-style: none; scrollbar-width: none; touch-action: pan-x; }
        .carousel-container::-webkit-scrollbar { display: none; }
        /* Set card width specifically for the carousel */
        .carousel-container .card { flex: 0 0 300px; } 
        .carousel-arrow { position: absolute; top: 50%; transform: translateY(calc(-50% - 1rem)); z-index: 10; background-color: #fff; color: var(--primary-red); border: none; border-radius: 50%; width: 44px; height: 44px; font-size: 1.2rem; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.15); transition: all 0.3s ease; }
        .carousel-arrow:hover { background-color: var(--primary-red); color: #fff; transform: translateY(calc(-50% - 1rem)) scale(1.05); }
        #scroll-left { left: 0px; }
        #scroll-right { right: 0px; }

        /* --- NO CARD STYLES HERE - Assumed to be in style.css --- */
        
        /* Features Section */
        .features { background-color: var(--light-pink-bg); display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem; text-align: center; }
        .feature img { width: 100px; height: 100px; object-fit: cover; border-radius: 50%; margin-bottom: 1rem; border: 4px solid #fff; box-shadow: var(--shadow); }
        .feature h3 { font-size: 1.4rem; margin-bottom: 0.5rem; color: var(--primary-red); }
        .feature p { color: #555; }

        /* About Section */
        .about { background-color: #fff; text-align: center; }
        .about p { max-width: 700px; margin: 0 auto; font-size: 1.1rem; color: #555; line-height: 1.8; }

        /* Reviews Section */
        .reviews { background-color: var(--soft-bg); }
        .review-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
        .review { background: #fff; padding: 2rem; border-radius: 15px; box-shadow: var(--shadow); border-bottom: 5px solid var(--accent-pink); }
        .review p { font-style: italic; color: #666; margin: 0 0 1rem 0; font-size: 1.1rem; }
        .review span { font-weight: 700; font-family: var(--heading-font); color: var(--primary-red); font-size: 1.1rem; }
        
        /* Final CTA Section */
        .shop-now { text-align: center; padding: 4rem 1rem; background: linear-gradient(90deg, #ff91a4, #ffb6c1); }
        .shop-now .btn.big { background: #fff; color: var(--primary-red); }
        .shop-now .btn.big:hover { background: var(--soft-bg); color: var(--primary-red); transform: scale(1.05); }

    </style>
</head>
<body>

    <nav class="navbar">
        <h1>üç¨ Sweet Spot</h1>
        <div class="nav-right">
            <a href="{% url 'home' %}">Home</a>
            <a href="{% url 'sweet_list' %}">Sweets</a>
            <a href="{% url 'cart_view' %}">
                <i class="fas fa-shopping-cart"></i> Cart
            </a>
        </div>
    </nav>

    <section class="hero">
        <div class="hero-content">
            <h1>A Legacy of Passion & Purity</h1>
            <p>It all began with a single pursuit: the perfect sweet. Today, that passion lives on in every bite.</p>
            <a href="{% url 'sweet_list' %}" class="btn">Explore Our Craft</a>
        </div>
    </section>

    <section class="best-sellers">
        <h2>Our Timeless Favorites</h2>
        <div class="carousel-wrapper">
            <button class="carousel-arrow" id="scroll-left" aria-label="Scroll left"><i class="fas fa-chevron-left"></i></button>
            <div class="carousel-container" id="carousel-container">
                {% for sweet in best_sellers %}
                <div class="card card--all-time-fav"> 
                    <a href="{% url 'sweet_detail' sweet.id %}" class="card-image-link">
                        <img src="{{ sweet.image.url }}" alt="{{ sweet.name }}">
                    </a>
                    <h3>{{ sweet.name }}</h3>
                    <p>‚Çπ{{ sweet.price }}</p>
                    <a href="{% url 'sweet_detail' sweet.id %}">
                        <button>Order Now</button> 
                    </a>
                </div>
                {% endfor %}
            </div>
            <button class="carousel-arrow" id="scroll-right" aria-label="Scroll right"><i class="fas fa-chevron-right"></i></button>
        </div>
    </section>

    <section class="features">
        <div class="feature">
            <img src="{% static 'testapp/images/ingredients.jpg' %}" alt="Pure Ingredients">
            <h3>Purest Ingredients</h3>
            <p>Fresh milk, pure ghee, and nuts. No compromises, ever.</p>
        </div>
        <div class="feature">
            <img src="{% static 'testapp/images/craftsman.jpg' %}" alt="Master Craftsmen">
            <h3>Master Craftsmen</h3>
            <p>In the hands of our 'ustaads,' generations of wisdom come alive.</p>
        </div>
        <div class="feature">
            <img src="{% static 'testapp/images/recipe.jpg' %}" alt="Nurtured Recipes">
            <h3>Nurtured Recipes</h3>
            <p>Every sweet holds a memory, a tradition, and a taste of home.</p>
        </div>
    </section>

    <section id="about" class="about">
        <h2>Our Story: The Sweet Spot Legacy</h2>
        <p>Sweet Spot was born from a family's fascination with mithai. What started in a humble kitchen has grown into a beloved legacy, now led by the next generation with the same purpose: upholding trust, taste, and timeless celebration.</p>
    </section>

    <section class="reviews">
        <h2>What Our Customers Say</h2>
        <div class="review-cards">
            <div class="review">
                <p>‚ÄúThe best Gulab Jamun I‚Äôve ever had! So soft and fresh!‚Äù</p>
                <span>- Riya Sharma</span>
            </div>
            <div class="review">
                <p>‚ÄúLove their sugar-free range! Tastes just as good as the real thing.‚Äù</p>
                <span>- Arjun Mehta</span>
            </div>
            <div class="review">
                <p>‚ÄúYou can taste the purity ‚Äî it feels homemade.‚Äù</p>
                <span>- Sneha Patel</span>
            </div>
        </div>
    </section>

    <section class="shop-now">
        <a href="{% url 'sweet_list' %}" class="btn big">Shop All Sweets</a>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const carousel = document.getElementById('carousel-container');
            const scrollLeftBtn = document.getElementById('scroll-left');
            const scrollRightBtn = document.getElementById('scroll-right');
            
            let animationFrameId = null; 
            let userStoppedScroll = false; // Flag to check if user interacted
            const scrollSpeed = 0.8; // Adjust speed here

            if (carousel) {
                
                const smoothScroll = () => {
                    if (!userStoppedScroll) {
                        carousel.scrollLeft += scrollSpeed;
                        // More robust check for reaching the end
                        if (Math.abs(carousel.scrollWidth - carousel.offsetWidth - carousel.scrollLeft) < scrollSpeed) {
                            carousel.scrollLeft = 0; // Loop back precisely
                        }
                        animationFrameId = requestAnimationFrame(smoothScroll);
                    } else {
                         if (animationFrameId) {
                             cancelAnimationFrame(animationFrameId);
                             animationFrameId = null;
                         }
                    }
                };

                const stopScroll = () => {
                    if (!userStoppedScroll) { 
                        userStoppedScroll = true; 
                        if (animationFrameId) {
                            cancelAnimationFrame(animationFrameId);
                            animationFrameId = null;
                        }
                        console.log("Auto-scroll stopped by user interaction."); 
                    }
                };
                
                const startScroll = () => {
                     // Check flag before starting
                     if (!userStoppedScroll && !animationFrameId) { 
                         console.log("Starting/Restarting simplified auto-scroll..."); 
                         // Reset scroll position slightly before starting ensures smooth loop after stop/start
                         // carousel.scrollLeft = carousel.scrollLeft; 
                         animationFrameId = requestAnimationFrame(smoothScroll); 
                     } else if (userStoppedScroll) {
                          console.log("Auto-scroll was previously stopped by user.");
                     }
                };

                // Initial Start
                startScroll(); 

                // Arrow functionality
                if(scrollLeftBtn && scrollRightBtn) {
                     scrollLeftBtn.addEventListener('click', () => {
                        stopScroll(); 
                        const firstCard = carousel.querySelector('.card');
                        const gap = parseFloat(window.getComputedStyle(carousel).gap) || 32;
                        const scrollAmount = firstCard ? firstCard.offsetWidth + gap : 332;
                        carousel.scrollBy({ left: -scrollAmount, behavior: 'smooth' }); 
                    });

                    scrollRightBtn.addEventListener('click', () => {
                        stopScroll(); 
                        const firstCard = carousel.querySelector('.card');
                        const gap = parseFloat(window.getComputedStyle(carousel).gap) || 32;
                        const scrollAmount = firstCard ? firstCard.offsetWidth + gap : 332;
                        carousel.scrollBy({ left: scrollAmount, behavior: 'smooth' });
                    });
                }

                // Stop auto-scroll on manual touch/drag/wheel
                ['touchstart', 'mousedown', 'wheel'].forEach(eventType => {
                    carousel.addEventListener(eventType, stopScroll, { once: true, passive: true });
                });

                 // Attempt to restart on visibility change (covers returning to tab, bfcache)
                 // This will respect the userStoppedScroll flag
                 document.addEventListener('visibilitychange', () => {
                    if (document.visibilityState === 'visible') {
                        console.log("Tab became visible. Attempting to restart scroll if needed.");
                        startScroll(); // Try to start scroll again
                    } else if (animationFrameId) {
                         // Optional: Pause animation when tab is hidden
                         cancelAnimationFrame(animationFrameId);
                         animationFrameId = null;
                         console.log("Tab hidden. Pausing scroll animation.");
                    }
                });

                // Add pageshow listener as a fallback for bfcache
                window.addEventListener('pageshow', (event) => {
                    if (event.persisted) {
                        console.log("Page restored from bfcache. Attempting to restart scroll if needed.");
                        startScroll(); // Attempt restart
                    }
                });


            } else {
                console.error("Carousel container not found!");
            }
        });
    </script>
    </body>
</html>